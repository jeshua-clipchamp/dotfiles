#!/bin/bash

BASE=$(pwd)

# Make sure we are in a repo.
if [ ! -f "package.json" ]; then
    echo "Should be run at the root of the clipchamp-stack repo (package.json file missing)."
    exit 1
fi

# Make sure we are in the right repo.
PACKAGE_NAME=$(cat package.json | jq -r ".name")
if [ "$PACKAGE_NAME" != "clipchamp-stack" ]; then
    echo "Should only be run in the clipchamp-stack repo (not $PACKAGE_NAME)."
    exit 1
fi

# Build libraries.
cd $BASE/libs/shared-js
npm run build

# Kill current sessions.
create-kill

# start-create
cd $BASE/frontend
screen -d -m -S start-create bash -c "npm run start-create"

# webserver-gae
cd $BASE
screen -d -m -S webserver-gae bash -c "gulp webserver-gae"

# Display current screens.
screen -ls
echo "Servers running, connect to http://localhost:4200"
